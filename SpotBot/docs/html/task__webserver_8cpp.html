<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SpotBot: src/task_webserver.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="CPME Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SpotBot
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">task_webserver.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &quot;PrintStream.h&quot;</code><br />
<code>#include &lt;WiFi.h&gt;</code><br />
<code>#include &lt;WebServer.h&gt;</code><br />
<code>#include &quot;<a class="el" href="shares_8h_source.html">shares.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aa2a5c774150998c42b693fd2fd4c1e0b"><td class="memItemLeft" align="right" valign="top"><a id="aa2a5c774150998c42b693fd2fd4c1e0b" name="aa2a5c774150998c42b693fd2fd4c1e0b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FAST_PIN</b>&#160;&#160;&#160;12</td></tr>
<tr class="memdesc:aa2a5c774150998c42b693fd2fd4c1e0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The GPIO pin cranking out a 500 Hz square wave. <br /></td></tr>
<tr class="separator:aa2a5c774150998c42b693fd2fd4c1e0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4bb2f6790489d53e1530b1f3bfdb043f"><td class="memItemLeft" align="right" valign="top"><a id="a4bb2f6790489d53e1530b1f3bfdb043f" name="a4bb2f6790489d53e1530b1f3bfdb043f"></a>
IPAddress&#160;</td><td class="memItemRight" valign="bottom"><b>local_ip</b> (192, 168, 5, 1)</td></tr>
<tr class="separator:a4bb2f6790489d53e1530b1f3bfdb043f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f5e4435988c442ffce0ac2f1a53d866"><td class="memItemLeft" align="right" valign="top"><a id="a7f5e4435988c442ffce0ac2f1a53d866" name="a7f5e4435988c442ffce0ac2f1a53d866"></a>
IPAddress&#160;</td><td class="memItemRight" valign="bottom"><b>gateway</b> (192, 168, 5, 1)</td></tr>
<tr class="separator:a7f5e4435988c442ffce0ac2f1a53d866"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89cf134ada28d8ce0192d9fcbc83614a"><td class="memItemLeft" align="right" valign="top"><a id="a89cf134ada28d8ce0192d9fcbc83614a" name="a89cf134ada28d8ce0192d9fcbc83614a"></a>
IPAddress&#160;</td><td class="memItemRight" valign="bottom"><b>subnet</b> (255, 255, 255, 0)</td></tr>
<tr class="separator:a89cf134ada28d8ce0192d9fcbc83614a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48f3f185be3ea2d153c347a157b38d42"><td class="memItemLeft" align="right" valign="top">WebServer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__webserver_8cpp.html#a48f3f185be3ea2d153c347a157b38d42">server</a> (80)</td></tr>
<tr class="memdesc:a48f3f185be3ea2d153c347a157b38d42"><td class="mdescLeft">&#160;</td><td class="mdescRight">The web server object for this project.  <a href="task__webserver_8cpp.html#a48f3f185be3ea2d153c347a157b38d42">More...</a><br /></td></tr>
<tr class="separator:a48f3f185be3ea2d153c347a157b38d42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2db7e734a3678bd61b7b9556caf2d933"><td class="memItemLeft" align="right" valign="top"><a id="a2db7e734a3678bd61b7b9556caf2d933" name="a2db7e734a3678bd61b7b9556caf2d933"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>setup_wifi</b> (void)</td></tr>
<tr class="memdesc:a2db7e734a3678bd61b7b9556caf2d933"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the WiFi running so we can serve some web pages. <br /></td></tr>
<tr class="separator:a2db7e734a3678bd61b7b9556caf2d933"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56d51c0dcf49cb5bc93d901581d3fed2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__webserver_8cpp.html#a56d51c0dcf49cb5bc93d901581d3fed2">HTML_header</a> (String &amp;a_string, const char *page_title)</td></tr>
<tr class="memdesc:a56d51c0dcf49cb5bc93d901581d3fed2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Put a web page header into an HTML string.  <a href="task__webserver_8cpp.html#a56d51c0dcf49cb5bc93d901581d3fed2">More...</a><br /></td></tr>
<tr class="separator:a56d51c0dcf49cb5bc93d901581d3fed2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab25b75a0fc1cc2eb45e7afa0f57b4a6a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__webserver_8cpp.html#ab25b75a0fc1cc2eb45e7afa0f57b4a6a">handle_DocumentRoot</a> ()</td></tr>
<tr class="memdesc:ab25b75a0fc1cc2eb45e7afa0f57b4a6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function that responds to HTTP requests without a subpage name.  <a href="task__webserver_8cpp.html#ab25b75a0fc1cc2eb45e7afa0f57b4a6a">More...</a><br /></td></tr>
<tr class="separator:ab25b75a0fc1cc2eb45e7afa0f57b4a6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0b9ea1d435271c3832076b57b803da7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__webserver_8cpp.html#ac0b9ea1d435271c3832076b57b803da7">handle_NotFound</a> (void)</td></tr>
<tr class="memdesc:ac0b9ea1d435271c3832076b57b803da7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Respond to a request for an HTTP page that doesn't exist.  <a href="task__webserver_8cpp.html#ac0b9ea1d435271c3832076b57b803da7">More...</a><br /></td></tr>
<tr class="separator:ac0b9ea1d435271c3832076b57b803da7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5cf8a6a96244f1207aa1ca6823c6d7ac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__webserver_8cpp.html#a5cf8a6a96244f1207aa1ca6823c6d7ac">handle_Toggle_LED</a> (void)</td></tr>
<tr class="memdesc:a5cf8a6a96244f1207aa1ca6823c6d7ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Toggle blue LED when called by the web server.  <a href="task__webserver_8cpp.html#a5cf8a6a96244f1207aa1ca6823c6d7ac">More...</a><br /></td></tr>
<tr class="separator:a5cf8a6a96244f1207aa1ca6823c6d7ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d7cdb90f67a02f58081566ff392b2b5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__webserver_8cpp.html#a4d7cdb90f67a02f58081566ff392b2b5">handle_CSV</a> (void)</td></tr>
<tr class="memdesc:a4d7cdb90f67a02f58081566ff392b2b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Show some simulated data when asked by the web server.  <a href="task__webserver_8cpp.html#a4d7cdb90f67a02f58081566ff392b2b5">More...</a><br /></td></tr>
<tr class="separator:a4d7cdb90f67a02f58081566ff392b2b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a577f28c6d870b5b9f1c4510d8195094a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__webserver_8cpp.html#a577f28c6d870b5b9f1c4510d8195094a">task_webserver</a> (void *p_params)</td></tr>
<tr class="memdesc:a577f28c6d870b5b9f1c4510d8195094a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task which sets up and runs a web server.  <a href="task__webserver_8cpp.html#a577f28c6d870b5b9f1c4510d8195094a">More...</a><br /></td></tr>
<tr class="separator:a577f28c6d870b5b9f1c4510d8195094a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a587ba0cb07f02913598610049a3bbb79"><td class="memItemLeft" align="right" valign="top"><a id="a587ba0cb07f02913598610049a3bbb79" name="a587ba0cb07f02913598610049a3bbb79"></a>
const char *&#160;</td><td class="memItemRight" valign="bottom"><b>ssid</b> = &quot;SpotBot&quot;</td></tr>
<tr class="separator:a587ba0cb07f02913598610049a3bbb79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4a2ebcb494493f648ae1e6975672575"><td class="memItemLeft" align="right" valign="top"><a id="aa4a2ebcb494493f648ae1e6975672575" name="aa4a2ebcb494493f648ae1e6975672575"></a>
const char *&#160;</td><td class="memItemRight" valign="bottom"><b>password</b> = &quot;pr0jp@$$&quot;</td></tr>
<tr class="separator:aa4a2ebcb494493f648ae1e6975672575"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59cd9f4f39202cbaad65ca3e0c2a5a60"><td class="memItemLeft" align="right" valign="top"><a id="a59cd9f4f39202cbaad65ca3e0c2a5a60" name="a59cd9f4f39202cbaad65ca3e0c2a5a60"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>ledPin</b> = 2</td></tr>
<tr class="memdesc:a59cd9f4f39202cbaad65ca3e0c2a5a60"><td class="mdescLeft">&#160;</td><td class="mdescRight">The pin connected to an LED controlled through the Web interface. <br /></td></tr>
<tr class="separator:a59cd9f4f39202cbaad65ca3e0c2a5a60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a604cb339d5af8275079a5b4d97db8314"><td class="memItemLeft" align="right" valign="top"><a id="a604cb339d5af8275079a5b4d97db8314" name="a604cb339d5af8275079a5b4d97db8314"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>rep_count</b> = 0</td></tr>
<tr class="separator:a604cb339d5af8275079a5b4d97db8314"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >This program runs a simple SpotBot web server, providing the user with useful information on how fast they are moving the weight. This can be helpful in gauging the strain on the user and testing their limits.</p>
<p >Based on an examples by A. Sinha at <code><a href="https://github.com/hippyaki/WebServers-on-ESP32-Codes">https://github.com/hippyaki/WebServers-on-ESP32-Codes</a></code> </p>
<dl class="section author"><dt>Author</dt><dd>A. Sinha </dd>
<dd>
JR Ridgely </dd>
<dd>
Christian Clephan </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2022-Mar-28 Original stuff by Sinha </dd>
<dd>
2022-Nov-04 Modified for ME507 use by Ridgely </dd>
<dd>
2022-Nov-30 Modified for SpotBot use by Christian Clephan </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2022 by the authors, released under the MIT License. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a4d7cdb90f67a02f58081566ff392b2b5" name="a4d7cdb90f67a02f58081566ff392b2b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d7cdb90f67a02f58081566ff392b2b5">&#9670;&nbsp;</a></span>handle_CSV()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handle_CSV </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Show some simulated data when asked by the web server. </p>
<p >The contrived data is sent in a relatively efficient Comma Separated Variable (CSV) format which is easily read by Matlab(tm) and Python and spreadsheets. This contains the time, and velocity data from both IMUs. </p>

</div>
</div>
<a id="ab25b75a0fc1cc2eb45e7afa0f57b4a6a" name="ab25b75a0fc1cc2eb45e7afa0f57b4a6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab25b75a0fc1cc2eb45e7afa0f57b4a6a">&#9670;&nbsp;</a></span>handle_DocumentRoot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handle_DocumentRoot </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function that responds to HTTP requests without a subpage name. </p>
<p >When another computer contacts this ESP32 through TCP/IP port 80 (the insecure Web port) with a request for the main web page, this callback function is run. It sends the main web page's text to the requesting machine. </p>

</div>
</div>
<a id="ac0b9ea1d435271c3832076b57b803da7" name="ac0b9ea1d435271c3832076b57b803da7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0b9ea1d435271c3832076b57b803da7">&#9670;&nbsp;</a></span>handle_NotFound()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handle_NotFound </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Respond to a request for an HTTP page that doesn't exist. </p>
<p >This function produces the Error 404, Page Not Found error. </p>

</div>
</div>
<a id="a5cf8a6a96244f1207aa1ca6823c6d7ac" name="a5cf8a6a96244f1207aa1ca6823c6d7ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5cf8a6a96244f1207aa1ca6823c6d7ac">&#9670;&nbsp;</a></span>handle_Toggle_LED()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handle_Toggle_LED </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Toggle blue LED when called by the web server. </p>
<p >For testing purposes, this function turns the little blue LED on a 38-pin ESP32 board on and off. It is called when someone enters <code><a href="http://server.address/toggle">http://server.address/toggle</a></code> as the web address request from a browser. </p>

</div>
</div>
<a id="a56d51c0dcf49cb5bc93d901581d3fed2" name="a56d51c0dcf49cb5bc93d901581d3fed2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56d51c0dcf49cb5bc93d901581d3fed2">&#9670;&nbsp;</a></span>HTML_header()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HTML_header </td>
          <td>(</td>
          <td class="paramtype">String &amp;&#160;</td>
          <td class="paramname"><em>a_string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>page_title</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Put a web page header into an HTML string. </p>
<p >This header may be modified if the developer wants some actual <em>style</em> for her or his web page. It is intended to be a common header (and stylle) for each of the pages served by this server. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a_string</td><td>A reference to a string to which the header is added; the string must have been created in each function that calls this one </td></tr>
    <tr><td class="paramname">page_title</td><td>The title of the page </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a48f3f185be3ea2d153c347a157b38d42" name="a48f3f185be3ea2d153c347a157b38d42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48f3f185be3ea2d153c347a157b38d42">&#9670;&nbsp;</a></span>server()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WebServer server </td>
          <td>(</td>
          <td class="paramtype">80&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The web server object for this project. </p>
<p >This server is responsible for responding to HTTP requests from other computers, replying with useful information.</p>
<p >It's kind of clumsy to have this object as a global, but that's the way Arduino keeps things simple to program, without the user having to write custom classes or other intermediate-level structures. </p>

</div>
</div>
<a id="a577f28c6d870b5b9f1c4510d8195094a" name="a577f28c6d870b5b9f1c4510d8195094a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a577f28c6d870b5b9f1c4510d8195094a">&#9670;&nbsp;</a></span>task_webserver()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_webserver </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Task which sets up and runs a web server. </p>
<p >After setup, function <code>handleClient()</code> must be run periodically to check for page requests from web clients. One could run this task as the lowest priority task with a short or no delay, as there generally isn't much rush in replying to web queries. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>Pointer to unused parameters </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
