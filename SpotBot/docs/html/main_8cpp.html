<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SpotBot: src/main.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="CPME Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SpotBot
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">main.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &lt;PrintStream.h&gt;</code><br />
<code>#include &lt;Wire.h&gt;</code><br />
<code>#include &lt;cstdlib&gt;</code><br />
<code>#include &quot;taskqueue.h&quot;</code><br />
<code>#include &quot;<a class="el" href="shares_8h_source.html">shares.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="task__spot_8h_source.html">task_spot.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="task__motor_8h_source.html">task_motor.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="task__webserver_8h_source.html">task_webserver.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aeb497507cf17b4e667164726f1a9d2a9"><td class="memItemLeft" align="right" valign="top"><a id="aeb497507cf17b4e667164726f1a9d2a9" name="aeb497507cf17b4e667164726f1a9d2a9"></a>
Queue&lt; float &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>vel_queue</b> (2, &quot;Velocities&quot;)</td></tr>
<tr class="separator:aeb497507cf17b4e667164726f1a9d2a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade3f20ddb8c4231b3e62eff0d0ad8487"><td class="memItemLeft" align="right" valign="top"><a id="ade3f20ddb8c4231b3e62eff0d0ad8487" name="ade3f20ddb8c4231b3e62eff0d0ad8487"></a>
Queue&lt; float &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>vel_r</b> (1000, &quot;Right Velocities recorded over a rep&quot;)</td></tr>
<tr class="separator:ade3f20ddb8c4231b3e62eff0d0ad8487"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8859f96e040052dabce9802ed220cc33"><td class="memItemLeft" align="right" valign="top"><a id="a8859f96e040052dabce9802ed220cc33" name="a8859f96e040052dabce9802ed220cc33"></a>
Queue&lt; float &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>vel_l</b> (1000, &quot;Left Velocities recorded over a rep&quot;)</td></tr>
<tr class="separator:a8859f96e040052dabce9802ed220cc33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c76538b76010c6174b66a572fc24abe"><td class="memItemLeft" align="right" valign="top"><a id="a8c76538b76010c6174b66a572fc24abe" name="a8c76538b76010c6174b66a572fc24abe"></a>
Queue&lt; float &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>timer</b> (1000, &quot;Time over rep&quot;)</td></tr>
<tr class="separator:a8c76538b76010c6174b66a572fc24abe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad34c28b7e77e784ff26a914b58f53c77"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#ad34c28b7e77e784ff26a914b58f53c77">task_IMU</a> (void *p_params)</td></tr>
<tr class="memdesc:ad34c28b7e77e784ff26a914b58f53c77"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task IMU grabs data from IMUs and converts into velocities to be used by other tasks.  <a href="main_8cpp.html#ad34c28b7e77e784ff26a914b58f53c77">More...</a><br /></td></tr>
<tr class="separator:ad34c28b7e77e784ff26a914b58f53c77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fc01d736fe50cf5b977f755b675f11d"><td class="memItemLeft" align="right" valign="top"><a id="a4fc01d736fe50cf5b977f755b675f11d" name="a4fc01d736fe50cf5b977f755b675f11d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>setup</b> ()</td></tr>
<tr class="separator:a4fc01d736fe50cf5b977f755b675f11d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top"><a id="afe461d27b9c48d5921c00d521181f12f" name="afe461d27b9c48d5921c00d521181f12f"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>loop</b> ()</td></tr>
<tr class="separator:afe461d27b9c48d5921c00d521181f12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aedb4bc942fe3d8a504582625bf289f5a"><td class="memItemLeft" align="right" valign="top"><a id="aedb4bc942fe3d8a504582625bf289f5a" name="aedb4bc942fe3d8a504582625bf289f5a"></a>
const int&#160;</td><td class="memItemRight" valign="bottom"><b>MPU_ADDR</b> = 0x68</td></tr>
<tr class="separator:aedb4bc942fe3d8a504582625bf289f5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbae8a366271a5bd58009eb76239654f"><td class="memItemLeft" align="right" valign="top"><a id="acbae8a366271a5bd58009eb76239654f" name="acbae8a366271a5bd58009eb76239654f"></a>
const int&#160;</td><td class="memItemRight" valign="bottom"><b>MPU_ADDR2</b> = 0x69</td></tr>
<tr class="separator:acbae8a366271a5bd58009eb76239654f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54119277ba8dabcc251f83a14ed9448a"><td class="memItemLeft" align="right" valign="top"><a id="a54119277ba8dabcc251f83a14ed9448a" name="a54119277ba8dabcc251f83a14ed9448a"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>calib_const</b> = 1825.5</td></tr>
<tr class="separator:a54119277ba8dabcc251f83a14ed9448a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15a86667ce13c0926bdb9e9b08ea5552"><td class="memItemLeft" align="right" valign="top"><a id="a15a86667ce13c0926bdb9e9b08ea5552" name="a15a86667ce13c0926bdb9e9b08ea5552"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>calib_const2</b> = 1485.2</td></tr>
<tr class="separator:a15a86667ce13c0926bdb9e9b08ea5552"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac8fef4e3b3d833f16d5cef8ddce1ae1"><td class="memItemLeft" align="right" valign="top"><a id="aac8fef4e3b3d833f16d5cef8ddce1ae1" name="aac8fef4e3b3d833f16d5cef8ddce1ae1"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>thresh</b> = 0.3</td></tr>
<tr class="separator:aac8fef4e3b3d833f16d5cef8ddce1ae1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc29fb7fadd39a1bc2e3c52532248689"><td class="memItemLeft" align="right" valign="top"><a id="afc29fb7fadd39a1bc2e3c52532248689" name="afc29fb7fadd39a1bc2e3c52532248689"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>vel</b> = 0</td></tr>
<tr class="separator:afc29fb7fadd39a1bc2e3c52532248689"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a857c916d2df6a427df6e3c1595e4ba6e"><td class="memItemLeft" align="right" valign="top"><a id="a857c916d2df6a427df6e3c1595e4ba6e" name="a857c916d2df6a427df6e3c1595e4ba6e"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>vel2</b> = 0</td></tr>
<tr class="separator:a857c916d2df6a427df6e3c1595e4ba6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c0ccd49af8109299e033b68e0b19a6f"><td class="memItemLeft" align="right" valign="top"><a id="a0c0ccd49af8109299e033b68e0b19a6f" name="a0c0ccd49af8109299e033b68e0b19a6f"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>vel_init</b> = 0</td></tr>
<tr class="separator:a0c0ccd49af8109299e033b68e0b19a6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86c1bf9c2b8fb4a27b40d6275ba0a9ae"><td class="memItemLeft" align="right" valign="top"><a id="a86c1bf9c2b8fb4a27b40d6275ba0a9ae" name="a86c1bf9c2b8fb4a27b40d6275ba0a9ae"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>vel_init2</b> = 0</td></tr>
<tr class="separator:a86c1bf9c2b8fb4a27b40d6275ba0a9ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71c6956105aa107794dae9065a4fd3f0"><td class="memItemLeft" align="right" valign="top"><a id="a71c6956105aa107794dae9065a4fd3f0" name="a71c6956105aa107794dae9065a4fd3f0"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>IMU_state</b> = 0</td></tr>
<tr class="separator:a71c6956105aa107794dae9065a4fd3f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08c44ef8317e8ddf8ebe49238123e9b9"><td class="memItemLeft" align="right" valign="top"><a id="a08c44ef8317e8ddf8ebe49238123e9b9" name="a08c44ef8317e8ddf8ebe49238123e9b9"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>tim_count</b> = 0</td></tr>
<tr class="separator:a08c44ef8317e8ddf8ebe49238123e9b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac196d59e44e091318ab3c8b5d5762c81"><td class="memItemLeft" align="right" valign="top"><a id="ac196d59e44e091318ab3c8b5d5762c81" name="ac196d59e44e091318ab3c8b5d5762c81"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>vel_size</b> = 100</td></tr>
<tr class="separator:ac196d59e44e091318ab3c8b5d5762c81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb451e9225bdeefab97464b4a36105f7"><td class="memItemLeft" align="right" valign="top"><a id="adb451e9225bdeefab97464b4a36105f7" name="adb451e9225bdeefab97464b4a36105f7"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>accelerometer_x</b></td></tr>
<tr class="separator:adb451e9225bdeefab97464b4a36105f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb96ad7bf3b6ac95f63df85521770ef5"><td class="memItemLeft" align="right" valign="top"><a id="adb96ad7bf3b6ac95f63df85521770ef5" name="adb96ad7bf3b6ac95f63df85521770ef5"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>accelerometer_y</b></td></tr>
<tr class="separator:adb96ad7bf3b6ac95f63df85521770ef5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b8766131ada7b41d9cf4176d7ff9fc5"><td class="memItemLeft" align="right" valign="top"><a id="a3b8766131ada7b41d9cf4176d7ff9fc5" name="a3b8766131ada7b41d9cf4176d7ff9fc5"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>accelerometer_z</b></td></tr>
<tr class="separator:a3b8766131ada7b41d9cf4176d7ff9fc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada5e769dfe2804b5eaf4fd206cd4d7c4"><td class="memItemLeft" align="right" valign="top"><a id="ada5e769dfe2804b5eaf4fd206cd4d7c4" name="ada5e769dfe2804b5eaf4fd206cd4d7c4"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>accelerometer_z_2</b></td></tr>
<tr class="separator:ada5e769dfe2804b5eaf4fd206cd4d7c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8dde3342979ed9986c16e356851a9c2a"><td class="memItemLeft" align="right" valign="top"><a id="a8dde3342979ed9986c16e356851a9c2a" name="a8dde3342979ed9986c16e356851a9c2a"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>gyro_x</b></td></tr>
<tr class="separator:a8dde3342979ed9986c16e356851a9c2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c42f0111bf74679a9c36bca042bf011"><td class="memItemLeft" align="right" valign="top"><a id="a7c42f0111bf74679a9c36bca042bf011" name="a7c42f0111bf74679a9c36bca042bf011"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>gyro_y</b></td></tr>
<tr class="separator:a7c42f0111bf74679a9c36bca042bf011"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7f04de51e63caab363ce9a56cd752bf"><td class="memItemLeft" align="right" valign="top"><a id="aa7f04de51e63caab363ce9a56cd752bf" name="aa7f04de51e63caab363ce9a56cd752bf"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>gyro_z</b></td></tr>
<tr class="separator:aa7f04de51e63caab363ce9a56cd752bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4af92569ea830250443045233c9bf5fb"><td class="memItemLeft" align="right" valign="top"><a id="a4af92569ea830250443045233c9bf5fb" name="a4af92569ea830250443045233c9bf5fb"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>temperature</b></td></tr>
<tr class="separator:a4af92569ea830250443045233c9bf5fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >This program includes task_IMU and creates/runs the other tasks using FreeRTOS. The program runs through tasks based off priority and timing in order to accomplish robot functionality. First data is collected using the IMUs whihc is sent to spot task to determine where the user is during the lift. This information determines whether the motor needs to be spun to save the user from being crushed.</p>
<dl class="section author"><dt>Author</dt><dd>Christian Clephan </dd></dl>
<dl class="section date"><dt>Date</dt><dd>12-2-22 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad34c28b7e77e784ff26a914b58f53c77" name="ad34c28b7e77e784ff26a914b58f53c77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad34c28b7e77e784ff26a914b58f53c77">&#9670;&nbsp;</a></span>task_IMU()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_IMU </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Task IMU grabs data from IMUs and converts into velocities to be used by other tasks. </p>
<p >First transmision is made between MCU and I2C devices where the IMUs are "woken up". Next, we combine the upper and lower byte values from the z acceleration data address to get the "tick" value of acceleration in z. This is then converted to m/s^2 and zero'd after some data analysis. The acceleration noise is set to zero and values are summed up in order to integrate. Velociteis are found through numerical integration and error propogation is somewhat mitigated and the values are put in their respective queues. <br  />
 </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
